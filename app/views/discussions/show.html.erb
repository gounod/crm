<%- model_class = Discussion -%>
<div class="page-header">
  <h1>Thema: <%= @discussion.title %></h1>
</div>

<dl class="dl-horizontal">
  <dt><strong>Thema:</strong></dt>
  <dd><%= raw(@discussion.description) %></dd>
  <dt><strong>Moderator:</strong></dt>
  <dd><%= @discussion.try(:user).try(:short_name) %></dd>
  <dt><strong><%= model_class.human_attribute_name(:state) %>:</strong></dt>
  <dd><%= tag_label(@discussion.state, :success) %></dd>
  <dt><strong>Keywords:</strong></dt>
  <dd>
    <% @discussion.tag_list.each do |tag| %>
      <%= tag_label(tag, :default) %>
    <% end %>
  </dd>
</dl>

<% if @discussion.user == current_user || current_user.has_role?(:moderator, @discussion) || current_user.has_role?(:admin) %>
  <%= link_to t('.edit', :default => t("helpers.links.edit")),
              edit_discussion_path(@discussion), :class => 'btn btn-default' %>
<% end %>
<% if current_user.has_role?(:admin) %>
<%= link_to t('.destroy', :default => t("helpers.links.destroy")),
              discussion_path(@discussion),
              :method => 'delete',
              :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
              :class => 'btn btn-danger' %>
<% end %>

<%= link_to "Kommentar schreiben", new_discussion_article_path(@discussion), :class => 'btn btn-primary', :remote => true %>

<div>
  <h2>Kommentare</h2>

  <% @discussion.articles.each do |article| %>
    <div class="article_element well">
      <div class="row description">
        <div class="col-md-12">
          <%= raw(article.description) %>
        </div>
      </div>
      <div class="row meta_description text-muted">
        <div class="col-md-8 user">
          <%= article.user.short_name %>
        </div>
        <div class="col-md-3 date">
          <%= article.created_at.strftime("%d.%m.%Y %H:%M Uhr") %>
        </div>
      </div>
    </div>
  <% end %>

</div>